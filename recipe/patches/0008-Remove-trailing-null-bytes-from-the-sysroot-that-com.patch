From a01d91b87c3487926b942f214406430dce5d8789 Mon Sep 17 00:00:00 2001
From: Chris Burr <christopher.burr@cern.ch>
Date: Thu, 3 Mar 2022 23:19:02 +0100
Subject: [PATCH] Remove trailing null bytes from the sysroot that come from
 conda's relocation

---
 lib/Driver/Driver.cpp | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/lib/Driver/Driver.cpp b/lib/Driver/Driver.cpp
index 5b9261e9..6da594e6 100644
--- a/lib/Driver/Driver.cpp
+++ b/lib/Driver/Driver.cpp
@@ -147,6 +147,9 @@ Driver::Driver(StringRef ClangExecutable, StringRef TargetTriple,
   if (!this->VFS)
     this->VFS = llvm::vfs::getRealFileSystem();
 
+  // Remove trailing null bytes from the sysroot that come from conda's relocation
+  SysRoot = std::string(SysRoot.c_str());
+
   Name = std::string(llvm::sys::path::filename(ClangExecutable));
   Dir = std::string(llvm::sys::path::parent_path(ClangExecutable));
   InstalledDir = Dir; // Provide a sensible default installed dir.
-- 
2.34.1

